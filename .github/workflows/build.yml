name: Build Electron App

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-windows:
    name: Build for Windows
    uses: ./.github/workflows/_electron-build.yml
    with:
      platform: windows
      publish_mode: never
      upload_artifacts: true
      node_version: "24"

  build-macos:
    name: Build for macOS (ARM64)
    uses: ./.github/workflows/_electron-build.yml
    with:
      platform: macos-arm64
      publish_mode: never
      upload_artifacts: true

  build-macos-x64:
    name: Build for macOS (x64)
    uses: ./.github/workflows/_electron-build.yml
    with:
      platform: macos-x64
      publish_mode: never
      upload_artifacts: true

  build-linux:
    name: Build for Linux
    uses: ./.github/workflows/_electron-build.yml
    with:
      platform: linux
      publish_mode: never
      upload_artifacts: true

  # Summary job to check if all builds succeeded
  build-summary:
    name: Build Summary
    runs-on: ubuntu-latest
    needs: [build-windows, build-macos, build-macos-x64, build-linux]
    if: always()

    steps:
      - name: Check build results
        run: |
          echo "Windows build: ${{ needs.build-windows.result }}"
          echo "macOS ARM64 build: ${{ needs.build-macos.result }}"
          echo "macOS x64 build: ${{ needs.build-macos-x64.result }}"
          echo "Linux build: ${{ needs.build-linux.result }}"

          if [ "${{ needs.build-windows.result }}" != "success" ] || [ "${{ needs.build-macos.result }}" != "success" ] || [ "${{ needs.build-macos-x64.result }}" != "success" ] || [ "${{ needs.build-linux.result }}" != "success" ]; then
            echo "❌ Some builds failed"
            exit 1
          else
            echo "✅ All builds succeeded"
          fi
